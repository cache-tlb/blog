---
title: "压垮骆驼的最后一根稻草"
date: 2022-09-25T15:09:05+08:00
categories: ["数学"]
---

## 问题

骆驼最大负重为 $1$，有一堆稻草，每一根稻草的重量都是 $(0, 1)$ 上独立的均匀分布。依次往骆驼的背上放稻草，直到总重量超过 $1$，这时骆驼就被压垮了。

问：骆驼被压垮时，平均身上有多少根稻草？稻草总重量的期望是多少？以及最后压垮骆驼的那一根稻草的重量期望是多少？

## 稻草数量

第一个问题最经典，经常出现在各大金融公司 / 互联网公司的笔试和面试题中。我们假设第 $i$ 根稻草重量为 $x_i$, 恰好压垮骆驼的稻草数量为 $n$，考虑 $n \ge k$ 的概率 $P(n \ge k)$ 的计算方法。

例如，$n \ge 2$ 意味着 $x_1 < 1$，这是显然成立的，故 $P(2) = 1$。

$n \ge 3$ 意味着 $x_1 + x_2 < 1$，以 $x_1,x_2$ 为两坐标轴，三条直线 $x_1 > 0, x_2 > 0, x_1 + x_2 < 1$ 围成的区域的面积就是对应的概率，为 $\dfrac{1}{2}$。

$n \ge 4$ 意味着 $x_1 + x_2 + x_3< 1$，它的概率是四个平面 $x_1 > 0, x_2 > 0, x_3 > 0, x_1+x_2+x_3 < 1$ 围成的三棱锥的体积，为 $\dfrac{1}{6}$。

以此类推，$n \ge k + 1$ 的概率为 $\dfrac{1}{k!}$。所以稻草数量的期望为 
$$
\begin{aligned}
E(n) &= 1\cdot P(n=1) + 2\cdot P(n=2) + 3\cdot P(n=3) \cdots\\\ 
&= 1\cdot( P(n\ge 1) -  P(n\ge 2)) + 2\cdot( P(n\ge 2) -  P(n\ge 3)) + \cdots\\\ 
&=  P(n\ge 1) +  P(n\ge 2) +  P(n\ge 3) + \cdots \\\ 
&= 1 + 1 + \frac{1}{2!} + \frac{1}{3!} + \cdots \\\ 
&= e
\end{aligned}
$$

也可以用动态规划的思路，定义 $F(x)$ 为骆驼剩余的负重还有 $x$ ，到被压垮时背上放的稻草根数的期望值，这里 $x$ 限制在 $[0, 1]$ 范围。则要求的就是 $F (1)$。 为了求一般的 $F (x)$ 的值, 考虑选取的第一根稻草, 分两种情况讨论：

(1) 若选取的第一个根稻草重量大于 $x$，概率为 $1 − x$，放一根稻草就压垮了。

(2) 若选取的第一个根稻草重量小于等于 $x$，例如重量为 $t$，概率为 $dt$，则从期望上来看为要放 $1 + F (x − t)$ 根稻草才能压垮。

两种情况加起来得：
$$
\begin{aligned}
F(x) &= (1-x)\cdot 1 + \int_0^x\left(1 + F(x-t)\right)\ \mathrm{d}t \\\ 
&= 1 + \int_0^x F(x-t)\ \mathrm{d}t \\\ 
&= 1 + \int_0^x F(t)\ \mathrm{d}t
\end{aligned}
$$
两边求导得 $F'(x) = F(x)$，并且初值为 $F (0) = 0$，解得 $F (x) = e^x$， 于是 $F (1) = e$。

## 稻草总重量

仍然假设第 $i$ 根稻草重量为 $x_i$，$S_k$ 为前 $k$ 根稻草的重量之和。设函数 $W(x)$ 为稻草重量之和恰好超过 $x$ 时的实际总重量，$ x\in[0,1] $，即
$$
W(x) = E(S_n | S_{n-1} < x, S_n > x) .
$$
类似的分两种情况讨论：

(1) 第一根稻草重量就超过了 $x$，例如 $x_1 = t > x$，这部分的期望为：
$$
E(x_1 | x_1 > x) = \int_x^1 t\ \mathrm{d}t = \frac{1-x^2}{2}
$$

(2) 第一根稻草重量小于 $x$, 例如 $x_1 = t < x$，需要递归考虑 $W(x - t)$的值，这部分的期望为：
$$
E(S_n | x_1 < x, S_{n-1} < t, S_n > t) = \int_0^x \left(t + W(x - t)\right)\ \mathrm{d}t = \frac{t^2}{2} + \int_0^x W(t)\ \mathrm{d}t
$$

两部分合起来得：
$$
W(x) =  \frac{1-x^2}{2} +  \frac{t^2}{2} + \int_0^x W(t)\ \mathrm{d}t = \frac{1}{2} + \int_0^x W(t)\ \mathrm{d}t
$$
将$x=0$代入可得初值为$W(0) = \dfrac{1}{2}$；此外对两边求导可得 $W'(x) = W(x)$，从而解得 $W(x) = \dfrac{e_x}{2}$。我们可以知道，骆驼被压垮时，背上的稻草总重量期望是 $\dfrac{e}{2}$。

## 压垮骆驼的最后一根稻草的重量

虽然所有稻草都满足相同的分布，最后这跟稻草看似与其他的没什么两样，但从另一个角度考虑，重量越大的稻草越有可能成为压垮骆驼的最后一根。
依然假设第 $i$ 根稻草重量为 $x_i$，前 $n$ 根稻草重量之和为 $s_n$，定义函数$g_n(x)$ 为前 $n$ 根稻草重量之和不超过 $x$ 的概率，这里 $x\in[0,1]$。由前面的推理可知它就是 $n$ 维单位立方体中截取一个棱锥的体积，
$$
g_n(x) = \mathrm{Prob}(s_n < x) = \frac{x^n}{n!}
$$
再定义函数 $f_n (x)$ 为事件 $s_n < 1 < s_n + x$ 发生的概率，即取了 $n$ 个稻草没有达到最大负重，但再取一个重量为 $x$ 的稻草就会超重。 将事件拆成两个不等式，再重新改写一下就是 $1 − x < s_n < 1$，可见有
$$
\begin{aligned}
f_n (x) &= \mathrm{Prob}(s_n < 1) − \mathrm{Prob}(s_n < 1 − x) \\\ 
&= g_n (1) − g_n (1 − x) \\\ 
&= \frac{1-(1-x)^n}{n!} .
\end{aligned}
$$
对所有的 $n$ 求和得到最后一根稻草重量为 $x$ 的概率为
$$
f(x) = \sum_{n=0}^\infty f_n(x) = e - e^{1-x} .
$$

$f(x)$ 就是最后一根稻草重量的 pdf，它并不是均匀分布，它的期望值为：
$$
E = \int_0^1 x\cdot f(x)\ \mathrm{d}x =  \int_0^1 x\cdot (e - e^{1-x} )\ \mathrm{d}x = 2 - \frac{e}{2} \approx 0.6486 .
$$

期望值大于 0.5，说明最后一根稻草平均来说是比普通稻草更重一些的。

